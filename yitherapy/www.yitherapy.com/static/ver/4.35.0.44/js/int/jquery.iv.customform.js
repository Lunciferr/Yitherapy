(function(a){a.fn.iv_customform=function(b){return this.each(function(){new a.iv.customform(this,b)})};a.iv.customform=function(b,k){var k=a.extend({decimal_a_message:"",decimal_b_message:"",dummy_data:null,email_message:"",extension:".html",file_extension_message:"file bad",hidden_recaptcha_id:null,js_view:null,number_message:"",phone_message:"",recaptcha_id:null,recaptcha_message:"",regions:"",required_message:""},k);var i=a(b);var j;var h=[];var d={};g();function g(){d=JSON.parse(decodeURIComponent(k.regions));a("select[linked]",i).each(function(){var p=a(this);var q=a(this).attr("linked");var o=a("#"+q);o.change(function(){var u=a("option:selected",o).text();if(u&&d[u]){var s=d[u];p.empty();p.append(a("<option value=''></option>"));for(var r=0;r<s.length;r++){var t=a("<option value='"+s[r]["id"]+"'>"+s[r]["name"]+"</option>");if(p.attr("default_value")==s[r]["name"]){t.attr("selected",true)}p.append(t)}p.show().removeClass("disabled");p.next().hide().addClass("disabled")}else{p.empty();p.hide().addClass("disabled");var v=p.next();v.show().removeClass("disabled")}});o.change()});a.validator.addMethod("phone",function(o,p){return o.match(/^[0-9\(\)\- ]*$/)},k.phone_message);a.validator.addMethod("decimal",function(r,p){var o=parseInt(a(p).attr("decimal_places"));if(o>0){var q=new RegExp("^\\d*\\.?\\d{0,"+o+"}$");return(q.test(r))}else{return(r.match(/^[0-9]*$/))}},function(o,q){var p=parseInt(a(q).attr("decimal_places"));if(p>0){return(k.decimal_a_message+p+k.decimal_b_message+Array(p+1).join("1"))}else{return(k.number_message)}});a.validator.addMethod("file_upload",function(o,p){return !o.match(/\.(exe|pif|bat|scr|lnk|com|vbs)$/)},k.file_extension_message);var l={required:k.required_message,email:k.email_message};var m={".phone":{phone:true}};if(k.recaptcha_id&&k.hidden_recaptcha_id){m[k.hidden_recaptcha_id]={required:true};l[k.hidden_recaptcha_id]=k.recaptcha_message}a.extend(a.validator.messages,l);i.validate({ignore:".ignore",rules:m,messages:a.validator.messages,errorClass:"invalid"});i.submit(e);a("input[other][type=radio]").each(function(){var p=this;var o=a(this).attr("name");a('input[name="'+o+'"]').change(function(){if(a(p).is(":checked")){a(p).next().removeAttr("disabled").removeClass("disabled")}else{a(p).next().attr("disabled","disabled").addClass("disabled")}})}).change();a("input[other][type=checkbox]").change(function(){if(a(this).is(":checked")){a(this).next().removeAttr("disabled").removeClass("disabled")}else{a(this).next().attr("disabled","disabled").addClass("disabled")}}).change();if(k.js_view){var n=i.attr("id")+"_iframe";j=a('<iframe id="'+n+'" name="'+n+'" src="#"></iframe>').hide();i.after(j);i.attr("target",n);i.attr("action","/public/customform/js_view")}}function e(){if(i.valid()){if(k.hidden_recaptcha_id){a("#"+k.hidden_recaptcha_id).remove()}if(k.dummy_data){alert("Please set up calendar.");return false}if(window.Prototype){delete Array.prototype.toJSON}var p=a("[contact_field]",i);var l={};for(var r=0;r<p.length;r++){var x=p[r];var t=a(x).attr("contact_field");var o=a(x).attr("column_name");if(!l[t]){l[t]={}}l[t][o]=a(x).attr("name")}if(a("input[name='_contact_groups']")[0]){a("input[name='_contact_groups']").val(JSON.stringify(l))}else{a("<input />").attr("type","hidden").attr("name","_contact_groups").attr("value",JSON.stringify(l)).appendTo(i)}var s=a("[custom_country]",i);var v=[];for(var r=0;r<s.length;r++){var w=a(s[r]);v.push(w.attr("name"))}if(a("input[name='_custom_countries']",i)[0]){a("input[name='_custom_countries']",i).val(JSON.stringify(v))}else{a("<input />").attr("type","hidden").attr("name","_custom_countries").val(JSON.stringify(v)).appendTo(i)}var q=a("[custom_state]",i);var y=[];for(var r=0;r<q.length;r++){var w=a(q[r]);y.push(w.attr("name"))}if(a("input[name='_custom_states']",i)[0]){a("input[name='_custom_states']",i).val(JSON.stringify(y))}else{a("<input />").attr("type","hidden").attr("name","_custom_states").val(JSON.stringify(y)).appendTo(i)}var n=a('input[type="file"]',i);var u=[];for(var r=0;r<n.length;r++){var w=a(n[r]);u.push(w.attr("name"))}if(a("input[name='_uploads']",i)[0]){a("input[name='_uploads']",i).val(JSON.stringify(u))}else{a("<input />").attr("type","hidden").attr("name","_uploads").val(JSON.stringify(u)).appendTo(i)}a(".disabled",i).remove();if(k.js_view){var m=i.parents('div[type="iv"]');a("<input />").attr("type","hidden").attr("name","__data").val(m.attr("data")).appendTo(i);a("<input />").attr("type","hidden").attr("name","__block_id").val(m.attr("block_id")).appendTo(i);j.load(function(){var B=JSON.parse(decodeURIComponent(m.attr("data")));var z=j.contents().find("body");if(B.values["confirm_message"]){m.html(z.html())}else{if(B.values["confirm_page"]){var A=B.values["confirm_page"]+"."+k.extension;a.ajax({url:A,type:"get",error:function(){A="../"+A;window.location=A},success:function(){window.location=A}})}else{if(B.values["confirm_url"]){window.location=B.values["confirm_url"]}else{m.html("Form submitted")}}}j.unbind("load");setTimeout(function(){z.html("")},1)})}}}function c(l){if(!isNaN(parseFloat(l))&&isFinite(l)){return true}else{return false}}function f(l){if(l==""){return false}else{return true}}}})(jQuery);